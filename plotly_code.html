<!DOCTYPE html>
<html>
<head>
    <title>Plotly.js 2x2 Subplots</title>
    <!-- Load Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div id="myDiv"></div>

</body>

<script>



    class TrendChart{


        constructor(){
            this.data_set = [];
        }


        getData(){
            this.data = {
                "GPMI12 ASM": {
                    x: [1, 2, 3, 4],
                    y: [5, 6, 7, 8],
                    layer: ['ND', 'AD', 'ND', 'AD'],
                    scan_result: ['OK', "Fail", "OK", "Fail"],
                    maskID: ["Test01", "Test02", "Test03", "Test04"],
                    spec_value: [9],
                    indicator: "ASM",
                    toolID: "GPMI12"
                },
                "KPMI08 ASM": {
                    x: [1, 2, 3, 4],
                    y: [10, 11, 12, 13],
                    layer: ['ND', 'AD', 'ND', 'AD'],
                    scan_result: ['OK', "Fail", "OK", "Fail"],
                    maskID: ["Test01", "Test02", "Test03", "Test04"],
                    spec_value: [9],
                    indicator: "ASM",
                    toolID: "KPMI08"
                }

            }

            this.getGridSize();
        }

        getGridSize(){
            var toolID_arr = [];
            var indicator_arr = [];

            for (let chart in this.data){
                toolID_arr.push(this.data[chart].toolID);
                indicator_arr.push(this.data[chart].indicator);
            }

            this.toolID_set = new Set(toolID_arr);
            this.indicator_set = new Set(indicator_arr);
            this.grid_size = [this.toolID_set.size, this.indicator_set.size];
        }

        generateSubplot(){




            var current_chart_idx = 0
            
            console.log(current_chart_idx, this.data_set);

            for (let chart in this.data){
                var data = {};
                data.x = this.data[chart].x;
                data.y = this.data[chart].y;
                data.xaxis = 'x'; 
                var y_axis_label = 'y' + (current_chart_idx + 1).toString();
                data.yaxis = y_axis_label;


                data.id = current_chart_idx.toString();

                console.log(current_chart_idx, this.data_set);
                console.log("Pushing data", this.data_set);
                this.data_set.push({...data});
                console.log("Pushing data OK", this.data_set);

                current_chart_idx += 1;
            }


            var layout = {
                grid: {
                    rows: 2,
                    columns: 1,
                    subplots:[['xy'], ['xy2']],
                    roworder:'top to bottom'
                }
            };

            Plotly.newPlot('myDiv', this.data_set, layout);

        }

    }





    var chart_obj = new TrendChart();
    chart_obj.getData();
    
    console.log(chart_obj.indicator_set, chart_obj.toolID_set ,chart_obj.grid_size);
    chart_obj.generateSubplot();



</script>
</html>
