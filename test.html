<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>


  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <style>
    /* Styling for the filter panel */
    #filterPanel {
      position: absolute;
      top: 20px;
      right: 20px;
      background-color: #f9f9f9;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
  </style>
</head>
<body>


  <div class="container-fluid">
    <div class="row">
      <div class="col-md-8">
        <div id="myPlot"></div>
      </div>


      <div class="col-md-4" id="select_panel">

      </div>
    </div>
  </div>




  <script>


    function createSelectBox(id, option_list){
      var select_panel = document.getElementById('select_panel');
      var selectbox = document.createElement("select");
      selectbox.multiple = true;
      selectbox.class = "form-control";
      selectbox.id = id;
      selectbox.style = "width:100%";
      selectbox.name = "filter_selectbox";


      option_list.forEach(function (text) {
        var option = document.createElement('option');
        option.value = text.toLowerCase();
        option.text = text;
        option.selected = true;
        selectbox.appendChild(option);
      });

      select_panel.append(selectbox);

      $('#' + id).select2();
      $('#' + id).on('change', function (e) {
        updateDataSet();
    });
    
    }


    var filter_dict = {
      "layer_arr": ['TypeA', 'TypeB', 'TypeA', 'TypeB', 'TypeA'],
      "node_arr": ['N2', "N2", "N3", "N3", "N3"],
    }


    var unique_layer_arr = new Set(filter_dict["layer_arr"]);
    var unique_node_arr = new Set(filter_dict["node_arr"]);
    createSelectBox("layer_arr", unique_layer_arr);
    createSelectBox("node_arr", unique_node_arr);


    var x_arr = [1, 2, 3, 4, 5];
    var y_arr = [10, 12, 8, 15, 7];
    
  function convertSelected(selected){
    var select_list = [];
    selected.forEach(function(data){
      select_list.push(data.text);
    })

    return select_list;

  }

  function updateDataSet(){
    console.log("Start Filtering");
  
    var filteredX = [];
    var filteredY = [];
    var filteredText = [];
    
    var selected_dict = {};
    $("select[name='filter_selectbox']").each(function(){
      var selected = convertSelected($(this).select2('data'));
      var selected_name = $(this).attr("id");
      selected_dict[selected_name] = selected;
    });

    for (var i = 0; i < x_arr.length; i++){
      var selected = true;
      for (var key in selected_dict){
        if (!selected_dict[key].includes(filter_dict[key][i])){
          selected = false;
          break;
        }
      }
        
      if (selected){
        filteredX.push(x_arr[i]);
        filteredY.push(y_arr[i]);
        filteredText.push(filter_dict['layer_arr'][i] + " " + filter_dict['node_arr'][i]);

      }
    }

    var newData = [{
      x: filteredX, // X-axis values
      y: filteredY, // Y-axis values
      type: 'scatter', // Type of chart (line chart in this case)
      mode: 'lines+markers', // Display lines and markers
      name: 'Sample Data', // Name of the dataset
      line: {
        color: 'blue' // Color of the line
      },
      text:filteredText
    }];

    Plotly.react('myPlot', newData, layout);


  }




    // Sample data for the line chart
    var data = [{
      x: x_arr, // X-axis values
      y: y_arr, // Y-axis values
      type: 'scatter', // Type of chart (line chart in this case)
      mode: 'lines+markers', // Display lines and markers
      name: 'Sample Data', // Name of the dataset
      line: {
        color: 'blue' // Color of the line
      },
      text: filter_dict["layer_arr"] // Text to display at each data point
    }];

    // Layout configuration
    var layout = {
      title: 'Sample Line Chart with Text',
      xaxis: {
        title: 'X-axis'
      },
      yaxis: {
        title: 'Y-axis'
      }
    };

    // Create the plot using Plotly
    var plot = Plotly.newPlot('myPlot', data, layout);





  </script>
</body>
</html>
